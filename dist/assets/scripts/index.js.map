{"version":3,"names":[],"mappings":"","sources":["index.js"],"sourcesContent":["/* globals anime, KeenSlider, Swiper, noUiSlider, Fancybox */\n\n/**\n * Components\n *\n * 00.Component - базовый класс компонента\n * 01.Menu - компонент меню\n * 02.Tabs - компонент табов\n * 03.Modal - компонент модального окна\n * 04.Detail - компонент деталей\n * 05.Counter - компонент счетчика\n * 06.ProductGallery - компонент галериеи продукта\n * 07.FullscreenSlider - компонент полноэкранного слайдера\n * 08.FiltersPopup - компонент попапа фильтров\n * 09.Ranger - компонент диапазона\n */\n\n/**\n * Component\n */\n\nclass Component {\n\tconstructor(target) {\n\t\tthis.component = target instanceof HTMLElement ? target : document.querySelector(target);\n\t}\n}\n\n/** Menu */\n\nclass Menu extends Component {\n\tconstructor(target = '.js-menu') {\n\t\tsuper(target);\n\n\t\tif (!this.component) return;\n\n\t\tthis.state = {\n\t\t\tisShow: false,\n\t\t};\n\n\t\tthis.hoverTriggers = this.component.querySelectorAll('.js-menu__hover-trigger');\n\t\tthis.hideTriggers = this.component.querySelectorAll('.js-menu__hide-trigger');\n\t\tthis.burger = document.querySelector('.js-menu-burger');\n\t\tthis.header = document.querySelector('.js-header');\n\n\t\tthis.init();\n\t}\n\n\tinit() {\n\t\tthis?.burger.addEventListener('click', this.toggle);\n\t\tthis?.hideTriggers.forEach((trigger) => {\n\t\t\ttrigger.addEventListener('click', this.hide);\n\t\t});\n\n\t\tthis?.hoverTriggers.forEach((trigger) => {\n\t\t\ttrigger.addEventListener('mouseenter', () => {\n\t\t\t\tif (this.header) this.header.classList.add('is-hovered');\n\t\t\t});\n\t\t\ttrigger.addEventListener('mouseleave', () => {\n\t\t\t\tif (this.header) this.header.classList.remove('is-hovered');\n\t\t\t});\n\t\t});\n\t}\n\n\tdestroy() {\n\t\tthis?.burger.removeEventListener('click', this.toggle);\n\t\tthis?.hideTriggers.forEach((trigger) => {\n\t\t\ttrigger.removeEventListener('click', this.hide);\n\t\t});\n\t}\n\n\ttoggle = () => {\n\t\tif (this.state.isShow) {\n\t\t\tthis.hide();\n\t\t} else {\n\t\t\tthis.show();\n\t\t}\n\t};\n\n\tshow = () => {\n\t\tthis.state.isShow = true;\n\t\tthis.burger.classList.add('is-active');\n\t\tthis.header.classList.add('is-active');\n\t\tthis.component.classList.add('is-active');\n\t\tdocument.body.classList.add('is-lock');\n\t};\n\n\thide = () => {\n\t\tthis.state.isShow = false;\n\t\tthis.burger.classList.remove('is-active');\n\t\tthis.header.classList.remove('is-active');\n\t\tthis.component.classList.remove('is-active');\n\t\tdocument.body.classList.remove('is-lock');\n\t};\n}\n\n/** Tabs */\n\nclass Tabs extends Component {\n\tconstructor(target = '.js-tabs') {\n\t\tsuper(target);\n\n\t\tif (!this.component) return;\n\n\t\tthis.buttons = this.component.querySelectorAll('.js-tabs-button');\n\t\tthis.content = this.component.querySelectorAll('.js-tabs-content');\n\n\t\tthis.init();\n\t}\n\n\tinit() {\n\t\tif (this.buttons[0]) this.change(this.buttons[0].getAttribute('data-tab-id'));\n\n\t\tthis.buttons.forEach((button) => {\n\t\t\tbutton.addEventListener('click', () => this.change(button.getAttribute('data-tab-id')));\n\t\t});\n\t}\n\n\tchange = (id) => {\n\t\tthis.buttons.forEach((item) => {\n\t\t\tif (item.getAttribute('data-tab-id') === id) item.classList.add('is-active');\n\t\t\tif (item.getAttribute('data-tab-id') !== id) item.classList.remove('is-active');\n\t\t});\n\t\tthis.content.forEach((item) => {\n\t\t\tif (item.getAttribute('data-tab-id') === id) item.classList.add('is-active');\n\t\t\tif (item.getAttribute('data-tab-id') !== id) item.classList.remove('is-active');\n\t\t});\n\t};\n}\n\n/** Modal */\n\nclass Modal extends Component {\n\tconstructor(target = '.js-molal') {\n\t\tsuper(target);\n\n\t\tif (!this.component) return;\n\n\t\tthis.showTriggers = document.querySelectorAll(`[data-show-modal=\"${this.component.id}\"]`);\n\t\tthis.hideTriggers = document.querySelectorAll(`[data-hide-modal=\"${this.component.id}\"]`);\n\n\t\tthis.init();\n\t}\n\n\tinit() {\n\t\tthis.showTriggers.forEach((trigger) => trigger.addEventListener('click', this.show));\n\t\tthis.hideTriggers.forEach((trigger) => trigger.addEventListener('click', this.hide));\n\n\t\tthis.component.addEventListener('click', ({ target }) => {\n\t\t\tif (target && target.hasAttribute('data-hide-modal')) this.hide();\n\t\t});\n\t}\n\n\tshow = () => {\n\t\tthis.component.classList.add('is-active');\n\t\tdocument.body.classList.add('is-lock');\n\t};\n\n\thide = () => {\n\t\tthis.component.classList.remove('is-active');\n\t\tdocument.body.classList.remove('is-lock');\n\t};\n}\n\n/** Detail */\n\nclass Detail extends Component {\n\tconstructor(target = '.js-detail') {\n\t\tsuper(target);\n\n\t\tif (!this.component) return;\n\n\t\tthis.state = {\n\t\t\tisShow: false,\n\t\t};\n\n\t\tthis.trigger = this.component.querySelector('.js-detail__button');\n\t\tthis.content = this.component.querySelector('.js-detail__body');\n\n\t\tthis.init();\n\t}\n\n\tinit() {\n\t\tif (this.component.getAttribute('data-detail-initial-state') === 'show') {\n\t\t\tsetTimeout(() => this.show(0), 200);\n\t\t} else {\n\t\t\tthis.hide(0);\n\t\t}\n\n\t\tthis.trigger.addEventListener('click', this.toggle);\n\t}\n\n\tdestroy() {\n\t\tanime.animate(this.content, {\n\t\t\theight: (elem) => elem.scrollHeight,\n\t\t\tduration: 0,\n\t\t});\n\n\t\tthis.trigger.removeEventListener('click', this.toggle);\n\t}\n\n\ttoggle = () => {\n\t\tif (this.state.isShow) {\n\t\t\tthis.hide();\n\t\t} else {\n\t\t\tthis.show();\n\t\t}\n\t};\n\n\tshow = (duration = 200) => {\n\t\tthis.state.isShow = false;\n\t\tthis.trigger.classList.remove('is-active');\n\t\tthis.content.classList.remove('is-active');\n\n\t\tanime.animate(this.content, {\n\t\t\theight: 0,\n\t\t\tduration,\n\t\t});\n\t};\n\n\thide = (duration = 200) => {\n\t\tthis.state.isShow = true;\n\t\tthis.trigger.classList.add('is-active');\n\t\tthis.content.classList.add('is-active');\n\n\t\tanime.animate(this.content, {\n\t\t\theight: (elem) => elem.scrollHeight,\n\t\t\tduration,\n\t\t});\n\t};\n}\n\n/** Counter */\n\nclass Counter extends Component {\n\tconstructor(target = '.js-counter') {\n\t\tsuper(target);\n\n\t\tif (!this.component) return;\n\n\t\tthis.state = {\n\t\t\tvalue: 0,\n\t\t};\n\n\t\tthis.increaseButton = this.component.querySelector('.js-counter__increase');\n\t\tthis.decreaseButton = this.component.querySelector('.js-counter__decrease');\n\t\tthis.valueContainer = this.component.querySelector('.js-counter__value');\n\n\t\tthis.init();\n\t}\n\n\tinit() {\n\t\tif (!this.valueContainer) return;\n\n\t\tthis.state.value = Number(this.valueContainer.value) || 0;\n\n\t\tthis?.increaseButton?.addEventListener('click', this.increase);\n\t\tthis?.decreaseButton?.addEventListener('click', this.decrease);\n\t}\n\n\tdestroy() {\n\t\tthis?.increaseButton?.removeEventListener('click', this.increase);\n\t\tthis?.decreaseButton?.removeEventListener('click', this.decrease);\n\t}\n\n\tincrease = () => {\n\t\tif (!this.valueContainer) return;\n\n\t\tthis.state.value += 1;\n\t\tthis.valueContainer.value = this.state.value;\n\t};\n\n\tdecrease = () => {\n\t\tif (!this.valueContainer || this.state.value <= 0) return;\n\n\t\tthis.state.value -= 1;\n\t\tthis.valueContainer.value = this.state.value;\n\t};\n}\n\n/** ProductGallery */\n\nclass ProductGallery extends Component {\n\tconstructor(target = '.js-product-gallery') {\n\t\tsuper(target);\n\n\t\tif (!this.component) return;\n\n\t\tthis.mainSlider = null;\n\t\tthis.thumbSlider = null;\n\n\t\tthis.init();\n\t}\n\n\tinit() {\n\t\tconst mainSliderElement = this.component?.querySelector('.js-product-gallery__main-slider');\n\t\tconst thumbSliderElement = this.component?.querySelector('.js-product-gallery__thumb-slider');\n\n\t\tif (!mainSliderElement) return;\n\n\t\tthis.mainSlider = new KeenSlider(mainSliderElement, {\n\t\t\tdisabled: false,\n\t\t\tdrag: false,\n\t\t\tslides: {\n\t\t\t\tperView: 1,\n\t\t\t\tspacing: 0,\n\t\t\t},\n\t\t\tbreakpoints: {\n\t\t\t\t'(min-width: 64rem)': {\n\t\t\t\t\tdisabled: true,\n\t\t\t\t\tslides: {\n\t\t\t\t\t\tperView: 99,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tdetailsChanged: (s) => {\n\t\t\t\ts.slides.forEach((element, idx) => {\n\t\t\t\t\telement.style.opacity = s.track.details.slides[idx].portion;\n\t\t\t\t\telement.style.zIndex = s.track.details.slides[idx].portion + 1;\n\t\t\t\t});\n\t\t\t},\n\t\t\trenderMode: 'custom',\n\t\t});\n\n\t\tif (thumbSliderElement && this.mainSlider) {\n\t\t\tthis.thumbSlider = new KeenSlider(\n\t\t\t\tthumbSliderElement,\n\t\t\t\t{\n\t\t\t\t\tinitial: 0,\n\t\t\t\t\tdisabled: false,\n\t\t\t\t\tslides: {\n\t\t\t\t\t\tperView: 4,\n\t\t\t\t\t\tspacing: 10,\n\t\t\t\t\t},\n\t\t\t\t\tbreakpoints: {\n\t\t\t\t\t\t'(min-width: 64rem)': {\n\t\t\t\t\t\t\tdisabled: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[this.ThumbnailPlugin(this.mainSlider)],\n\t\t\t);\n\t\t}\n\t}\n\n\tThumbnailPlugin(main) {\n\t\treturn (slider) => {\n\t\t\tfunction removeActive() {\n\t\t\t\tslider.slides.forEach((slide) => {\n\t\t\t\t\tslide.classList.remove('active');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction addActive(idx) {\n\t\t\t\tslider.slides[idx].classList.add('active');\n\t\t\t}\n\n\t\t\tfunction addClickEvents() {\n\t\t\t\tslider.slides.forEach((slide, idx) => {\n\t\t\t\t\tslide.addEventListener('click', () => {\n\t\t\t\t\t\tmain.moveToIdx(idx);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tslider.on('created', () => {\n\t\t\t\taddActive(slider.track.details.rel);\n\t\t\t\taddClickEvents();\n\t\t\t\tmain.on('animationStarted', (main) => {\n\t\t\t\t\tremoveActive();\n\t\t\t\t\tconst next = main.animator.targetIdx || 0;\n\t\t\t\t\taddActive(main.track.absToRel(next));\n\t\t\t\t\tslider.moveToIdx(Math.min(slider.track.details.maxIdx, next));\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t}\n}\n\n/** FullscreenSlider */\n\nclass FullscreenSlider {\n\tconstructor(targetSelector, footerSelector) {\n\t\tthis.targetSelector = targetSelector;\n\t\tthis.footerSelector = footerSelector;\n\t\tthis.mainSwiper = null;\n\t\tthis.footerSwiper = null;\n\t\tthis.headingAnimation = null;\n\n\t\tthis.init();\n\t}\n\n\tinit() {\n\t\tthis.prepareFirstSlideAnimation();\n\t\tthis.initMainSlider();\n\t\tthis.initFooterSlider();\n\t}\n\n\tinitMainSlider() {\n\t\tthis.mainSwiper = new Swiper(this.mainSelector, {\n\t\t\tdirection: 'vertical',\n\t\t\tmousewheel: true,\n\t\t\tspeed: 800,\n\t\t\teffect: 'creative',\n\t\t\tresistance: false,\n\t\t\tcreativeEffect: {\n\t\t\t\tprev: { translate: [0, 0, -0.5] },\n\t\t\t\tnext: { translate: [0, '100%', 0] },\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tslideChange: () => this.onSlideChange(),\n\t\t\t},\n\t\t});\n\n\t\tthis.onSlideChange();\n\t}\n\n\tinitFooterSlider() {\n\t\tthis.footerSwiper = new Swiper(this.footerSelector, {\n\t\t\tdirection: 'vertical',\n\t\t\tslidesPerView: 'auto',\n\t\t\tfreeMode: true,\n\t\t\tresistance: false,\n\t\t\tmousewheel: {\n\t\t\t\treleaseOnEdges: true,\n\t\t\t},\n\t\t\tnested: true,\n\t\t});\n\t}\n\n\tprepareFirstSlideAnimation() {\n\t\tconst firstSlide = document.querySelector(`${this.mainSelector} .swiper-slide:first-child`);\n\t\tif (!firstSlide) return;\n\n\t\tconst heading = firstSlide.querySelector('.fullscreen-slider__slide-heading');\n\t\tif (!heading) return;\n\n\t\tconst { chars } = anime.text.split(heading, { chars: true, words: true });\n\n\t\tthis.headingAnimation = anime.animate(chars, {\n\t\t\topacity: { from: 0, to: 1 },\n\t\t\tdelay: anime.stagger(100),\n\t\t\tease: 'inQuad',\n\t\t\tautoplay: false,\n\t\t});\n\t}\n\n\tonSlideChange() {\n\t\tconst header = document.querySelector('header');\n\t\tif (!header) return;\n\n\t\tconst activeSlide = this.mainSwiper.slides[this.mainSwiper.activeIndex];\n\t\tif (!activeSlide) return;\n\n\t\tconst headerColor = activeSlide.getAttribute('data-header-color') || '';\n\n\t\theader.className = header.className\n\t\t\t.split(' ')\n\t\t\t.filter((c) => !c.startsWith('header--'))\n\t\t\t.join(' ');\n\n\t\tif (headerColor) {\n\t\t\theader.classList.add(`header--${headerColor}`);\n\t\t}\n\n\t\tif (this.mainSwiper.activeIndex === 0 && this.headingAnimation) {\n\t\t\tthis.headingAnimation.restart();\n\t\t}\n\t}\n}\n\n/** FiltersPopup */\n\nclass FiltersPopup extends Component {\n\tconstructor(target = '.js-filters-popup') {\n\t\tsuper(target);\n\n\t\tif (!this.component) return;\n\n\t\tthis.showTrigger = document.querySelector('.js-filters-popup-show');\n\t\tthis.hideTrigger = document.querySelector('.js-filters-popup-hide');\n\n\t\tthis.init();\n\t}\n\n\tinit() {\n\t\tthis.showTrigger?.addEventListener('click', this.show);\n\t\tthis.hideTrigger?.addEventListener('click', this.hide);\n\t}\n\n\tdestroy() {\n\t\tthis.showTrigger?.removeEventListener('click', this.show);\n\t\tthis.hideTrigger?.removeEventListener('click', this.hide);\n\t}\n\n\tshow = () => {\n\t\tthis.component.classList.add('is-active');\n\t};\n\n\thide = () => {\n\t\tthis.component.classList.remove('is-active');\n\t};\n}\n\n/** Ranger */\nclass Ranger extends Component {\n\tconstructor(target = '.js-ranger') {\n\t\tsuper(target);\n\n\t\tif (!this.component) return;\n\n\t\tthis.state = {\n\t\t\tminValue: 0,\n\t\t\tmaxValue: 100,\n\t\t};\n\n\t\tthis.slider = this.component.querySelector('.js-ranger__slider');\n\t\tthis.value = this.component.querySelector('.js-ranger__value');\n\t\tthis.inputMin = this.component.querySelector('.js-ranger__input-min');\n\t\tthis.inputMax = this.component.querySelector('.js-ranger__input-max');\n\n\t\tthis.init();\n\t}\n\n\tinit() {\n\t\tthis.state.minValue = Number(this.inputMin.value);\n\t\tthis.state.minValue = Number(this.inputMax.value);\n\n\t\tnoUiSlider.create(this.slider, {\n\t\t\tstart: [this.state.minValue, this.state.maxValue],\n\t\t\tconnect: true,\n\t\t\trange: {\n\t\t\t\tmin: this.state.minValue,\n\t\t\t\tmax: this.state.maxValue,\n\t\t\t},\n\t\t});\n\n\t\tthis.slider.noUiSlider.on('update', (values) => {\n\t\t\tconst min = Math.round(values[0]);\n\t\t\tconst max = Math.round(values[1]);\n\n\t\t\tthis.value.textContent = `Цены: ${min} ₽ – ${max} ₽`;\n\n\t\t\tthis.inputMin.value = min;\n\t\t\tthis.inputMax.value = max;\n\t\t});\n\n\t\tthis.inputMin.addEventListener('change', () => {\n\t\t\tlet val = Number(this.inputMin.value);\n\t\t\tlet maxVal = Number(this.inputMax.value);\n\t\t\tif (val < 0) val = 0;\n\t\t\tif (val > maxVal) val = maxVal;\n\t\t\tthis.slider.noUiSlider.set([val, null]);\n\t\t});\n\n\t\tthis.inputMax.addEventListener('change', () => {\n\t\t\tlet val = Number(this.inputMax.value);\n\t\t\tlet minVal = Number(this.inputMin.value);\n\t\t\tif (val > 100) val = 100;\n\t\t\tif (val < minVal) val = minVal;\n\t\t\tthis.slider.noUiSlider.set([null, val]);\n\t\t});\n\t}\n}\n\n/**\n * Utility\n *\n * 01.initFancyboxProductGallery - запуск модуля Fancybox для продукта\n * 02.initSmoothScrollLinks - запуск модуля ссылок якорей\n * 03.initHeaderScrolling - запуск модуля плавающего Header\n */\n\n/** initFancyboxProductGallery */\nfunction initFancyboxProductGallery() {\n\tFancybox.bind('[data-fancybox]', {\n\t\tCarousel: {\n\t\t\tThumbs: false,\n\t\t\tToolbar: {\n\t\t\t\tdisplay: {\n\t\t\t\t\tleft: [],\n\t\t\t\t\tmiddle: [],\n\t\t\t\t\tright: ['close'],\n\t\t\t\t},\n\t\t\t},\n\t\t\tZoomable: {\n\t\t\t\tPanzoom: {\n\t\t\t\t\tminScale: 0.5,\n\t\t\t\t\tclickAction: 'toggleCover',\n\t\t\t\t\tmouseMoveFactor: 1,\n\t\t\t\t\tstartScale: 'cover',\n\t\t\t\t},\n\t\t\t},\n\t\t\tVideo: {\n\t\t\t\thtml5videoTpl: `\n\t\t\t\t\t<video class=\"f-html5video\" playsinline loop muted poster=\"{{poster}}\">\n\t\t\t\t\t\t<source src=\"{{src}}\" type=\"{{format}}\" />Sorry, your browser doesn't support embedded videos.\n\t\t\t\t\t</video>\n\t\t\t\t`,\n\t\t\t},\n\t\t},\n\t});\n}\n\n/** initSmoothScrollLinks */\nfunction initSmoothScrollLinks() {\n\tdocument.addEventListener('click', function (e) {\n\t\tconst link = e.target.closest('a.js-link-anchor[href^=\"#\"]');\n\t\tif (!link) return;\n\n\t\tconst targetId = link.getAttribute('href').substring(1);\n\t\tif (!targetId) return;\n\n\t\tconst targetElement = document.getElementById(targetId);\n\t\tif (!targetElement) return;\n\n\t\te.preventDefault();\n\n\t\ttargetElement.scrollIntoView({\n\t\t\tbehavior: 'smooth',\n\t\t\tblock: 'start',\n\t\t});\n\t});\n}\n\n/** initHeaderScrolling */\nfunction initHeaderScrolling() {\n\tconst header = document.querySelector('.js-header');\n\n\tconst setIsScrolled = () => {\n\t\tif (window.scrollY > 5) {\n\t\t\theader.classList.add('is-scrolled');\n\t\t} else {\n\t\t\theader.classList.remove('is-scrolled');\n\t\t}\n\t};\n\n\tsetIsScrolled();\n\n\twindow.addEventListener('scroll', setIsScrolled);\n}\n\n/**\n * Main function\n */\nwindow.addEventListener('DOMContentLoaded', () => {\n\tnew Menu();\n\tnew FiltersPopup();\n\tnew ProductGallery();\n\tnew FullscreenSlider('#fullscreen-slider', '#fullscreen-slider-footer');\n\n\tnew Modal();\n\n\tdocument.querySelectorAll('.js-tabs').forEach((elem) => new Tabs(elem));\n\tdocument.querySelectorAll('.js-detail').forEach((elem) => new Detail(elem));\n\tdocument.querySelectorAll('.js-counter').forEach((elem) => new Counter(elem));\n\tdocument.querySelectorAll('.js-ranger').forEach((elem) => new Ranger(elem));\n\n\tinitFancyboxProductGallery();\n\tinitSmoothScrollLinks();\n\tinitHeaderScrolling();\n});\n"],"file":"index.js"}